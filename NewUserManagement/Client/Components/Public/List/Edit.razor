@page "/list/edit/{UserId}"
@using NewUserManagement.Shared.Models
@using System.Net.Http.Json
@using System.Net.Http
@inject HttpClient HttpClient
@inject NavigationManager NavigationManager

@if (_viewModalWindow)
{
	<View UserDetails="@selectedUser" ShowModal="@_viewModalWindow" OnCloseModal="CloseModal" />
}
<div class="modal @_modalClass" id="informationalModal" tabindex="-1" aria-labelledby="informationalModalLabel" role="dialog" style="display:@_modalDisplay">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Edit User Details</h5>
				<button @onclick="CloseModal" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				@if (UserDetails != null)
				{
					<div>
						<p><strong>Id:</strong> @UserDetails.Id</p>
						<p><strong>Forename:</strong><InputText> @UserDetails.Forename</InputText></p>
						<p><strong>Surname:</strong> <InputText> @UserDetails.Surname</InputText></p>
						<p><strong>Email:</strong> <InputText> @UserDetails.Email</InputText></p>
						<p><strong>Active:</strong> @(UserDetails.IsActive ? "Yes" : "No")</p>
						<p><strong>Date of Birth:</strong> @UserDetails.DateOfBirth.ToShortDateString()</p>
					</div>
				}
				else
				{
					<p>Loading user details...</p>
				}
			</div>
			<div class="modal-footer">
				<button @onclick="PreviousUser" type="button" class="btn btn-primary btn-lg shadow">Previous</button>
				<button @onclick="NextUser" type="button" class="btn btn-primary btn-lg shadow">Next</button>
				<button @onclick="CloseModal" type="button" class="btn btn-primary btn-lg shadow" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

@code {
	private string _modalDisplay = "none"; // Initialize modal display property
	private string _modalClass = "";
	private List<User> _users = new List<User>();
	private int _currentIndex;
	// Define the UserDetailId property
	[Parameter] public int? UserDetailId { get; set; }
	// Define the ShowModal property
	// Define the OnCloseModal property
	[Parameter] public EventCallback OnCloseModal { get; set; }

	private bool _viewModalWindow = false;
	private User? selectedUser = new User(); // Define a variable to store the selected user details

	// Define properties and event callback for the modal
	[Parameter] public User? UserDetails { get; set; }
	[Parameter] public bool ShowModal { get; set; }

	// Close modal method
	private void CloseModal()
	{
		_viewModalWindow = false;
	}
	protected override async Task OnInitializedAsync()
	{
		await base.OnInitializedAsync(); // Ensure the base initialization is awaited
		var uri = new Uri(NavigationManager.Uri);
		if (uri.Segments.Length >= 3 && int.TryParse(uri.Segments[2], out int userId))
		{
			// Find user details by ID
			UserDetails = _users.FirstOrDefault(u => u.Id == userId) ?? new User();
			// Provide a default User instance if no matching user is found
			// Find index of current user in the list
			_currentIndex = _users.IndexOf(UserDetails);
		}
		else
		{
			// Handle invalid URL parameter
			Console.WriteLine("Invalid URL parameter.");
			// Redirect or display error message to the user
		}
	}


	private void NextUser()
	{
		_currentIndex++;
		if (_currentIndex >= _users.Count)
		{
			_currentIndex = 0; // Wrap around to the first user if reached the end
		}
		UserDetails = _users[_currentIndex];
	}

	private void PreviousUser()
	{
		_currentIndex--;
		if (_currentIndex < 0)
		{
			_currentIndex = _users.Count - 1; // Wrap around to the last user if reached the beginning
		}
		UserDetails = _users[_currentIndex];
	}


}
